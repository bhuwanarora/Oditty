homeApp.controller("feedController",["$scope","$rootScope","userService","$mdBottomSheet","shelfService","$timeout","$location","userService","bookService",function(a,b,c,d,e,f,g,c,h){a.search_books=function(b){a.info.loading=!0,h.search_books(b,10).then(function(b){a.info.loading=!1,a.did_you_mean=!0,angular.forEach(b,function(a){angular.isUndefined(a.fuzzy)&&this.push(a)},a.search_results)})},a.change_feed=function(){a.feed=[],setCookie("active_region",a.info.active_region,31),a.get_community_feed()};var i=function(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a};a.get_community_feed=function(){if(!a.info.loading){a.info.loading=!0;a.info.active_region;angular.isUndefined(a.feed)&&(a.feed=[]);var b=a.feed.length;c.get_feed(b).then(function(b){a.info.loading=!1,a.feed=a.feed.concat(i(b))})}},a.get_blog_feed=function(){if(!a.info.loading){a.info.loading=!0,angular.isUndefined(a.feed)&&(a.feed=[]);var b=a.feed.length,d=!0;c.get_blog_feed(b,d).then(function(b){angular.forEach(b,function(a){a.label="blog",this.push(a)},a.feed),a.info.loading=!1})}};(function(){a.feed=[];var b=getCookie("active_region");if(angular.isDefined(b)&&""!=b&&null!=b){a.info.active_region=b;f(function(){a.info.active_region=b},2e3)}var d=g.absUrl();a.$on("destroy",function(){f.cancel(timeout_event)}),c.get_regions().then(function(b){a.regions=b[0].regions});var e=d.indexOf("communities")>0,h=d.indexOf("blogs")>0;a.info.loading=!1,e?a.get_community_feed():h?a.get_blog_feed():a.get_community_feed()})()}]);