homeApp.service("newsService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_news_info=function(c,d){return angular.isDefined(d)&&""!=d?_deferred_request("/api/v0/news_info?id="+c+"&tag_id="+d,b,a):_deferred_request("/api/v0/news_info?id="+c,b,a)},this.get_chronological_news=function(c){return _deferred_request("/api/v0/chronological_news?id="+c,b,a)},this.get_community_details=function(c){return _deferred_request("/api/v0/basic_community_info?id="+c,b,a)},this.get_metadata=function(c){return _deferred_request("/api/v0/metadata?url="+c,b,a)},this.get_detailed_community_info=function(c){return _deferred_request("/api/v0/detailed_community_info?id="+c,b,a)},this.follow=function(c,d){return _deferred_request("/api/v0/follow_community?id="+c+"&status="+d,b,a)},this.get_feed_info=function(c){return _deferred_request("/api/v0/feed_community_info?id="+c,b,a)},this.news_visited=function(c){return _deferred_request("/api/v0/news_visited?id="+c,b,a)},this.get_community_news=function(c,d){return _deferred_request("/api/v0/get_community_news?id="+c+"&skip="+d,b,a)}}]);;homeApp.service("roomService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_books_grouped_by_shelves=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/book_shelves?id="+c,b,a):_deferred_request("/api/v0/book_shelves",b,a)},this.get_articles_grouped_by_shelves=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/article_shelves?id="+c,b,a):_deferred_request("/api/v0/article_shelves",b,a)},this.get_visited_articles=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/visited_articles?id="+c,b,a):_deferred_request("/api/v0/visited_articles",b,a)},this.get_visited_books=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/visited_books?id="+c,b,a):_deferred_request("/api/v0/visited_books",b,a)}}]);;homeApp.directive("friendInfo",["$rootScope","userService",function(a,b){return{restrict:"E",scope:{friend:"=",info:"="},controller:["$scope",function(a){var c=function(){angular.isDefined(a.friend)&&b.get_user_details(a.friend.id).then(function(b){a.friend=angular.extend(a.friend,b)})};c()}],templateUrl:"/assets/angular/html/shared/partials/friend_info.html"}}]),homeApp.directive("authorInfo",["$rootScope","authorService","ColorConstants","$mdDialog",function(a,b,c,d){return{restrict:"E",scope:{author:"=",info:"="},controller:["$scope",function(a){var c=function(){angular.isDefined(a.author)&&b.get_basic_info(a.author.id).then(function(b){a.author=angular.extend(a.author,b)})};c()}],templateUrl:"/assets/angular/html/shared/partials/author_info.html"}}]),homeApp.directive("communityInfo",["$rootScope","newsService","ColorConstants","$mdDialog","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{community:"=",info:"="},controller:["$scope",function(c){c.show_book_dialog=function(b,d){e.show_book_dialog(a,c,b,d)};var d=function(){angular.isDefined(c.community)&&b.get_feed_info(c.community.id).then(function(a){c.community=angular.extend(c.community,a)})};d()}],templateUrl:"/assets/angular/html/shared/partials/community_info.html"}}]),homeApp.directive("userCommunities",["$rootScope","userService",function(a,b){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var c=function(){a.rooms=[],b.get_communities(a.userId).then(function(b){angular.forEach(b,function(a){var b=angular.extend(a,{status:1});this.push(b)},a.rooms)})};c()}],templateUrl:"/assets/angular/html/rooms/show.html"}}]),homeApp.directive("bookShelf",["$rootScope","roomService","$mdDialog","sharedService",function(a,b,c,d){return{restrict:"E",scope:{shelf:"=",info:"="},controller:["$scope",function(b){b.toggle=function(){b.show_shelf=!b.show_shelf},b.show_indexes=function(a,d){b.book=a,c.show({templateUrl:"assets/angular/html/shared/rating.html",clickOutsideToClose:!0,hasBackdrop:!1,targetEvent:d,scope:b,preserveScope:!0}),d.stopPropagation()},b.add_books_to_shelf=function(c,d){a.active_shelf=c,b.info.show_book_share=!0};var d=function(){1==b.shelf.books.length&&null==b.shelf.books[0].title?b.show_shelf=!1:b.shelf.books.length>0?b.show_shelf=!0:b.show_shelf=!1};d()}],templateUrl:"/assets/angular/html/room/partials/book_shelf.html"}}]),homeApp.directive("articleShelf",["$rootScope","roomService","ColorConstants",function(a,b,c){return{restrict:"E",scope:{shelf:"="},controller:["$scope",function(a){a.toggle=function(){a.show_shelf=!a.show_shelf};var b=function(){1==a.shelf.articles.length&&null==a.shelf.articles[0].title?a.show_shelf=!1:a.shelf.articles.length>0?a.show_shelf=!0:a.show_shelf=!1};b()}],templateUrl:"/assets/angular/html/room/partials/article_shelf.html"}}]),homeApp.directive("articles",["$rootScope","roomService","userService",function(a,b,c){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var d=function(){b.get_visited_articles(a.userId).then(function(b){angular.isUndefined(a.visited_articles)&&(a.visited_articles=[]),a.visited_articles=a.visited_articles.concat(b),a.shelf_loading=!1})},e=function(){a.shelf_loading=!0,d();var b=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.profile.history||(deleteCookie("todo"),c.update_todo_key("profile/history")))};b()};e()}],templateUrl:"/assets/angular/html/room/show.html"}}]),homeApp.directive("articleShelves",["$rootScope","roomService","ColorConstants",function(a,b,c){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var c=function(){b.get_articles_grouped_by_shelves(a.userId).then(function(b){a.articles_grouped_by_shelves=b,a.shelf_loading=!1})},d=function(){a.shelf_loading=!0,c()};d()}],templateUrl:"/assets/angular/html/room/_right_panel.html"}}]),homeApp.directive("bookShelves",["$rootScope","roomService","userService",function(a,b,c){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var d=function(){b.get_books_grouped_by_shelves(a.userId).then(function(b){angular.isUndefined(a.book_shelves)&&(a.book_shelves=[]),a.book_shelves=b,e(),a.shelf_loading=!1})},e=function(){var b=function(a,b){var c=!1,d=0;return angular.forEach(b,function(b,e){a==b.shelf&&(c=!0,d=e)}),{status:c,index:d}},c=[];angular.forEach(a.book_shelves,function(a){var d=b(a.shelf,c);d.status?c[d.index].books.push(a.books[0]):c.push(a)}),a.book_shelves=c},f=function(){a.shelf_loading=!0;var b=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.profile.shelves||(deleteCookie("todo"),c.update_todo_key("profile/shelves")))};b(),d()};f()}],templateUrl:"/assets/angular/html/room/_left_panel.html"}}]);;homeApp.controller("genresController",["$scope","$rootScope","$timeout","userService","genreService","WebsiteUIConstants","$mdToast",function(a,b,c,d,e,f,g){a.save_genre=function(a){var b={genre:a.id,status:!0};d.save_user_info(b)},a.remove_genre=function(a){var b={genre:a.id,status:!1};d.save_user_info(b)},a.edit_genres_like=function(){a.goto_info_card(),b.user.profile_status=1,a._get_genres()},a._get_genres=function(){a.info.loading=!0,(angular.isUndefined(a.info.genres)||0==a.info.genres.length)&&(a.info.genres=[],e.get_categories().then(function(b){angular.forEach(b,function(a){var b=0!=a.likes_weight&&null!=a.likes_weight,c=f.GenreAWS+a.root_category_aws_key,d=angular.extend({status:b,url:c},a);this.push(d)},a.info.genres),a.info.loading=!1}))},a.select_genre=function(b){if(b.status){b.status=!1;var c={category_id:b.root_category_id,status:!1}}else{b.status=!0;var c={category_id:b.root_category_id,status:!0}}g.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/select_genre.html",hideDelay:6e3,position:a.getToastPosition()}),d.save_user_info(c)},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},_init=function(){a.toast_position={bottom:!1,top:!0,left:!1,right:!0};var b=c(function(){a._get_genres()},100);a.$on("destroy",function(){c.cancel(b)})},_init()}]);;homeApp.controller("networkController",["$scope","$rootScope","networkService","$location","$mdToast","userService",function(a,b,c,d,e,f){a.get_followers=function(){a.selectedIndex=0,a.load_followers()},a.toggle_follow=function(a){angular.isDefined(a.status)&&null!=a.status?(a.status=null,f.follow(a.id,!1)):(a.status=!0,f.follow(a.id,!0))},a.load_followers=function(){if(!a.info.loading){a.info.loading=!0;var b=a.users_list.length,d=a.active_user_id;c.get_followers(b,d).then(function(b){b&&0==b.length?a.hide_show_more=!0:a.users_list=a.users_list.concat(b),a.info.loading=!1})}},a.load_users_followed=function(){if(!a.info.loading){a.info.loading=!0;var b=a.users_list.length,d=a.active_user_id;c.get_users_followed(b,d).then(function(b){b&&0==b.length?a.hide_show_more=!0:a.users_list=a.users_list.concat(b),a.info.loading=!1})}},a.get_users_followed=function(){a.selectedIndex=1,a.load_users_followed()},a.load_users=function(){angular.isUndefined(a.users_list)&&(a.users_list=[]);var b="/profile/followers"==d.path(),c="/profile/followings"==d.path();b?a.get_followers():c&&a.get_users_followed()},a.say_thanks=function(){e.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/invite_success.html",hideDelay:6e3,position:a.getToastPosition()})},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},a.facebook_invite=function(){navigator.userAgent.indexOf("Mobi")>-1?FB.ui({method:"send",title:"Hey! Check this awesome book discovery website..",message:"Spread the love for books",link:"http://www.oditty.me/"},a.say_thanks()):window.location.replace("https://www.facebook.com/dialog/send?app_id=667868653261167&link=http://www.oditty.me&redirect_uri=http://oditty.me/network?q=0")};(function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(d.absUrl());a.load_users(),angular.isUndefined(b.user)?f.get_user_details().then(function(c){b.user=c,a.profile_user=b.user,a.active_user_id=a.profile_user.id}):(a.profile_user=b.user,a.active_user_id=a.profile_user.id),angular.isDefined(e)&&null!=e&&(a.active_user_id=e[2]),a.hide_follow=!0,a.toast_position={bottom:!1,top:!0,left:!1,right:!0}})()}]);;homeApp.controller("profileController",["$scope","userService","$rootScope","WebsiteUIConstants","ColorConstants","$location","bookService","newsService","$mdDialog","infinityService","$timeout","sharedService","$mdSidenav","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.show_todo_list=function(b){n.show({templateUrl:"assets/angular/html/todo/profile.html",scope:a,preserveScope:!0,targetEvent:b})},a.hide_bottomsheet=function(a){n.hide()},a.toggle_genres=function(){a.show_genres=!a.show_genres},a.get_active_class=function(a){var b=""==f.path().substr(1,a.length+1)&&"profile/feed"==a;return f.path().substr(1,a.length+1)==a||b?"bold red_color":"grey_color"},a.get_feed=function(){a.info.selectedIndex=1;var c="/profile/followers"==f.path(),d="/profile/followings"==f.path(),e="/profile/books"==f.path(),g="/profile/news"==f.path(),h="/profile/history"==f.path(),i="/profile/rooms"==f.path(),j=!(c||d||e||g||h||i||h);if(!a.info.loading&&j){var k=a.active_user_id;a.info.loading=!0;var l=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10.";break;case"FollowsNode":angular.isDefined(a.community)?b="Joined a room.":angular.isDefined(a.author)?b="Started following an Author.":angular.isDefined(a.friend)&&(b="Started following.");break;case"RecommendNode":b="Recommended this book to a friend."}return b};angular.isUndefined(a.personal_feed)&&(a.personal_feed=[]);var m=a.personal_feed.length;b.get_personal_feed(k,m).then(function(b){b.length>0&&angular.forEach(b,function(a){if(angular.isDefined(a.book)){var b=l(a);a=angular.extend(a,{message:b})}else if(angular.isDefined(a.community)){var b=l(a);a=angular.extend(a,{message:b})}else{var b=l(a);a=angular.extend(a,{message:b})}}),a.info.loading=!1,a.personal_feed=a.personal_feed.concat(b)})}};var o=function(){return""==getCookie("logged")||null==getCookie("logged")};a.follow_user=function(){o()?m("signup").toggle():(a.profile_user.status=!a.profile_user.status,b.follow(a.profile_user.id,a.profile_user.status))};a.show_book_dialog=function(b,d){l.show_book_dialog(c,a,b,d)};var p=function(){var b=!1;return a.active_user_id==c.user.id?(b=!0,a.info.my_profile=!0,a.hide_follow_links=!1):(a.info.my_profile=!1,a.hide_follow_links=!0),b},q=function(){var c=p();c?t():b.get_user_details(a.active_user_id).then(function(b){a.profile_user=b,r()})},r=function(){var b=a.profile_user.image_url||"/assets/user_profile.jpg";a.profile_wrapper={"background-image":b}},s=function(d){a.active_user_id=d[2],angular.isDefined(c.user)?q():b.get_user_details().then(function(a){c.user=a,q()})},t=function(){a.profile_user=c.user,a.active_user_id=a.profile_user.id,r()},u=function(){if(a.info.my_profile=!0,a.hide_follow_links=!1,angular.isUndefined(c.user)){var d=k(function(){b.get_user_details().then(function(a){c.user=a,t()})},100);a.$on("destroy",function(){k.cancel(d)})}else t();w()},v=function(){var b=k(function(){a.get_feed()},100);a.$on("destroy",function(){k.cancel(b)})},w=function(){var b=getCookie("todo");b&&(b=JSON.flatten(JSON.parse(b)));var c=0;angular.forEach(b,function(a,b){a&&(c+=1)}),a.profile_progress=Math.round(100*(c/15))};(function(){a.profile_user={},a.info.embed_share=!0;var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());angular.isDefined(c)&&null!=c?s(c):u(),v(),a.is_profile=!0})()}]);