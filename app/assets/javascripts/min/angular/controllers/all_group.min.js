homeApp.controller("rdContainerController",["websiteService","$scope","$rootScope","$document","sharedService","$timeout",function(a,b,c,d,e,f){b.render_page=function(a){e.render_page(a)},b.goto_page=function(a){window.open(a.full_url,"_blank").focus()},b.remove_container=function(a){var b=c.containers;b.splice(a,1),delete c.containers,c.containers=[],f(function(){angular.forEach(b,function(a){this.push(a)},c.containers)},100)};(function(){c.pages=!0,c.containers=[];var a=function(){var a={url:"author",id:2343423,full_url:"author",header:"Author"};c.containers.push(a)};a()})()}]),document.onclick=function(a){a=a||window.event;var b=a.target||a.srcElement,c=String(b.textContent).replace(/^\s+|\s+$/g,"");return"A"==b.tagName?(a.preventDefault(),!1):"FIGCAPTION"==b.tagName?(a.preventDefault(),b=b.getElementsByClassName("no_anchor"),!1):b.classList.contains("no_anchor")?(a.preventDefault(),!1):"Go to Book"==c?(a.preventDefault(),!1):void 0},String.prototype.toCamel=function(){return this.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})};;homeApp.service("roomsService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_rooms=function(c){return _deferred_request("/api/v0/get_rooms?skip="+c,b,a)}}]);;homeApp.controller("roomsController",["$scope","$location","roomsService","$mdSidenav","newsService","$mdBottomSheet","userService",function(a,b,c,d,e,f,g){a.get_rooms=function(){if(!a.info.loading){a.info.loading=!0,angular.isUndefined(a.rooms)&&(a.rooms=[]);var b=a.rooms.length;c.get_rooms(b).then(function(b){a.rooms=a.rooms.concat(b),a.info.loading=!1})}},a.join_room=function(a){var b=""==getCookie("logged")||null==getCookie("logged");if(b)d("signup").toggle();else{a.status=!a.status;var c=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.rooms.join||(deleteCookie("todo"),g.update_todo_key("rooms/join")))};c(),e.follow(a.id,a.status)}},a.show_todo_list=function(b){f.show({templateUrl:"assets/angular/html/todo/rooms.html",scope:a,preserveScope:!0,targetEvent:b})};(function(){a.get_rooms()})()}]);;homeApp.controller("authorsController",["$scope","authorService","sharedService",function(a,b,c){a.get_authors_interviewed=function(){if(!a.info.loading){a.info.loading=!0,angular.isUndefined(a.authors_interviewed)&&(a.authors_interviewed=[]);var c=a.authors_interviewed.length;b.get_authors_interviewed(c).then(function(b){a.info.loading=!1,a.authors_interviewed=a.authors_interviewed.concat(b)})}},a.handle_scroll_bottom=function(){a.get_authors_interviewed()},a.render_page=function(a){c.render_page(a)};(function(){a.get_authors_interviewed()})()}]);;homeApp.directive("joinCommunity",["$rootScope","newsService","$mdSidenav",function(a,b,c){return{restrict:"E",scope:{community:"="},controller:["$scope",function(a){var d=function(){return""==getCookie("logged")||null==getCookie("logged")};a.toggle=function(){if(d())c("signup").toggle();else{var e=a.community.id;a.community.status=!a.community.status,b.follow(e,a.community.status)}}}],templateUrl:"/assets/angular/html/home/partials/community.html"}}]);;homeApp.controller("feedController",["$scope","$rootScope","userService","$mdBottomSheet","shelfService","$timeout","$location","userService","bookService",function(a,b,c,d,e,f,g,c,h){a.search_books=function(b){a.info.loading=!0,h.search_books(b,10).then(function(b){a.info.loading=!1,a.did_you_mean=!0,angular.forEach(b,function(a){angular.isUndefined(a.fuzzy)&&this.push(a)},a.search_results)})},a.change_feed=function(){a.feed=[],setCookie("active_region",a.info.active_region,31),a.get_community_feed()},a.get_community_feed=function(){if(!a.info.loading){a.info.loading=!0;a.info.active_region;angular.isUndefined(a.feed)&&(a.feed=[]);var b=a.feed.length;c.get_feed(b).then(function(b){a.info.loading=!1,angular.forEach(b,function(a){var b={label:"news"};a=angular.extend(a,b),this.push(a)},a.feed)})}},a.get_blog_feed=function(){if(!a.info.loading){a.info.loading=!0,angular.isUndefined(a.feed)&&(a.feed=[]);var b=a.feed.length,d=!0;c.get_blog_feed(b,d).then(function(b){angular.forEach(b,function(a){a.label="blog",this.push(a)},a.feed),a.info.loading=!1})}};(function(){a.feed=[];var b=getCookie("active_region");if(angular.isDefined(b)&&""!=b&&null!=b){a.info.active_region=b;f(function(){a.info.active_region=b},2e3)}var d=g.absUrl();a.$on("destroy",function(){f.cancel(timeout_event)}),c.get_regions().then(function(b){a.regions=b[0].regions});var e=d.indexOf("communities")>0,h=d.indexOf("blogs")>0;a.info.loading=!1,e?a.get_community_feed():h?a.get_blog_feed():a.get_community_feed()})()}]);;homeApp.controller("networkController",["$scope","$rootScope","networkService","$location","$mdToast","userService",function(a,b,c,d,e,f){a.get_followers=function(){a.selectedIndex=0,a.load_followers()},a.toggle_follow=function(a){angular.isDefined(a.status)&&null!=a.status?(a.status=null,f.follow(a.id,!1)):(a.status=!0,f.follow(a.id,!0))},a.load_followers=function(){if(!a.info.loading){a.info.loading=!0;var b=a.users_list.length,d=a.active_user_id;c.get_followers(b,d).then(function(b){b&&0==b.length?a.hide_show_more=!0:a.users_list=a.users_list.concat(b),a.info.loading=!1})}},a.load_users_followed=function(){if(!a.info.loading){a.info.loading=!0;var b=a.users_list.length,d=a.active_user_id;c.get_users_followed(b,d).then(function(b){b&&0==b.length?a.hide_show_more=!0:a.users_list=a.users_list.concat(b),a.info.loading=!1})}},a.get_users_followed=function(){a.selectedIndex=1,a.load_users_followed()},a.load_users=function(){angular.isUndefined(a.users_list)&&(a.users_list=[]);var b="/profile/followers"==d.path(),c="/profile/followings"==d.path();b?a.get_followers():c&&a.get_users_followed()},a.say_thanks=function(){e.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/invite_success.html",hideDelay:6e3,position:a.getToastPosition()})},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},a.facebook_invite=function(){navigator.userAgent.indexOf("Mobi")>-1?FB.ui({method:"send",title:"Hey! Check this awesome book discovery website..",message:"Spread the love for books",link:"http://www.oditty.me/"},a.say_thanks()):window.location.replace("https://www.facebook.com/dialog/send?app_id=667868653261167&link=http://www.oditty.me&redirect_uri=http://oditty.me/network?q=0")};(function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(d.absUrl());a.load_users(),angular.isUndefined(b.user)?f.get_user_details().then(function(c){b.user=c,a.profile_user=b.user,a.active_user_id=a.profile_user.id}):(a.profile_user=b.user,a.active_user_id=a.profile_user.id),angular.isDefined(e)&&null!=e&&(a.active_user_id=e[2]),a.hide_follow=!0,a.toast_position={bottom:!1,top:!0,left:!1,right:!0}})()}]);;homeApp.directive("newsScroller",["$rootScope","newsService",function(a,b){return{restrict:"E",controller:["$scope",function(a){var c=function(){var c=a.info.active_news_id;b.get_chronological_news(c).then(function(b){a.news=b,angular.forEach(a.news,function(b,c){parseInt(a.info.active_news_id)==b.id&&(a.selectedIndex=c,a.info.active_news=b)})})};c()}],templateUrl:"/assets/angular/html/news/_footer.html"}}]),homeApp.directive("visitNews",["newsService",function(a){return{restrict:"E",scope:{newsId:"="},controller:["$scope",function(b){(function(){a.news_visited(b.newsId)})()}]}}]);;homeApp.controller("newsController",["$scope","$mdSidenav","newsService","$location","$rootScope","$mdDialog","ColorConstants","$timeout","sharedService",function(a,b,c,d,e,f,g,h,i){a.toggle_details=function(){b("right").toggle()},a.get_detailed_community_info=function(){c.get_detailed_community_info(a.active_tag.id).then(function(b){a.active_tag=angular.extend(a.active_tag,b);var c=a.active_tag.follow_node;angular.isDefined(c)&&null!=c&&(a.active_tag.status=!0),a._check_users()})},a.toggle_follow=function(){var d=""==getCookie("logged")||null==getCookie("logged");d?b("signup").toggle():(a.active_tag.status=!a.active_tag.status,c.follow(a.active_tag.id,a.active_tag.status))},a.show_book_dialog=function(b,c){i.show_book_dialog(e,a,b,c)},a.refresh_data=function(b){delete a.active_tag,a.info.loading=!0,a.active_tag=b,c.get_community_details(b.id).then(function(b){a.active_tag=b[0].most_important_tag[0],angular.forEach(a.active_tag.books,function(a){var b=Math.floor(Math.random()*g.value.length),c=g.value[b];a.color=c}),a.info.loading=!1}),a.info.circles,a.get_detailed_community_info()},a._check_users=function(){if(1==a.active_tag.users.length){var b=a.active_tag.users[0].first_name;(angular.isUndefined(b)||null==b)&&(a.active_tag.users=[])}},a.get_news_info=function(b){c.get_news_info(b,e.active_community).then(function(b){a.info.loading=!1,b=b[0],a.active_tag=b.most_important_tag[0];var c={name:a.active_tag.name,view_count:a.active_tag.view_count,id:a.active_tag.id,image_url:a.active_tag.image_url};a.newsTags.push(c),a.newsTags=a.newsTags.concat(b.other_tags),angular.forEach(a.active_tag.books,function(a){var b=Math.floor(Math.random()*g.value.length),c=g.value[b];a.color=c}),a._check_users(),a.get_detailed_community_info()})};(function(){var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(d.absUrl());if(null!=c)var f=c[2];if(angular.isDefined(f))var g=f;else var g=e.active_community.news_id;a.info.active_news_id=g,a.newsTags=[],a.info.active_tag=a.active_tag,a.info.loading=!0;var i=h(function(){a.get_news_info(g)},100);a.$on("destroy",function(){h.cancel(i)})})()}]);;homeApp.directive("timeTravel",["websiteService","$timeout","$location","CompressedYears","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{info:"=",activeTag:"="},controller:["$scope",function(a){a.show_all_times=function(){a.show_all=!a.show_all},a.get_active_class=function(a){var b=c.path().substr(1,a.length+1).replace("/",""),d=""==b&&"recent"==a;return b.indexOf(a)>=0||d?"active_time":b.indexOf("room")>=0&&"recent"==a?"active_time":void 0};var b=function(){a.active_tag=a.activeTag;var b=c.path().substr(1,5).replace("/",""),f=c.path().substr(1,7),g=c.path().split("/")[2];angular.isDefined(a.active_tag)&&delete a.active_tag.news,f.indexOf("recent")>=0||""==b||"room"==b?(a.show_all=!1,a.info.active_time="recent"):(b.indexOf("2014")>=0||b.indexOf("2013")>=0||b.indexOf("1998")>=0?a.show_all=!1:a.show_all=!0,a.info.active_time=b.replace("/","")),angular.isUndefined(g)?"recent"==a.info.active_time?a.info.active_month="Sept":a.info.active_month="Dec":a.info.active_month=g,e.get_community_news(a),a.years=d};b()}],templateUrl:"/assets/angular/html/shared/time_travel.html"}}]),homeApp.directive("months",["websiteService","$timeout","$location","Months","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{info:"="},controller:["$scope",function(a){a.get_active_class=function(b){b=a.info.active_time+"/"+b;var d=c.path().substr(1,b.length+1),e=""==d&&"recent"==b;if(d.indexOf(b)>=0||e)return"active_time";if(b.indexOf(d)>=0)if(b.indexOf("recent")>=0){if(b.indexOf("Sept")>=0)return"active_time"}else if(b.indexOf("Dec")>=0)return"active_time"};var b=function(){a.months=d};b()}],templateUrl:"/assets/angular/html/shared/months.html"}}]);;homeApp.controller("videoController",["$scope","$rootScope","$timeout","websiteService","$sce",function(a,b,c,d,e){a.add_video=function(b){var c=a.active_tag.id;d.add_video(c,b)};(function(){if(angular.isDefined(a.active_tag)&&angular.isDefined(a.active_tag.id)){var b=a.active_tag.id;d.get_community_videos(b).then(function(b){a.active_tag.videos=[],angular.forEach(b,function(a){a.url=a.url.replace("watch?v=","v/").replace("https","http").replace("http","https"),a.url=e.trustAsResourceUrl(a.url+"?output=embed"),this.push(a)},a.active_tag.videos)})}else $location.path("/room/books")})()}]);;homeApp.controller("communityController",["$scope","newsService","$rootScope","websiteService","$timeout","$location","$mdDialog","userService","$mdSidenav","sharedService","$sce","bookService","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.get_detailed_community_info=function(){angular.isDefined(a.active_tag)&&b.get_detailed_community_info(a.active_tag.id).then(function(b){a.active_tag=angular.extend(a.active_tag,b);var c=a.active_tag.follows_node;a.active_tag.wiki_url&&null!=a.active_tag.wiki_url&&(a.active_tag.wiki_url=k.trustAsResourceUrl(a.active_tag.wiki_url+"?action=render")),angular.isDefined(c)&&null!=c&&(a.active_tag.status=!0),a.refresh_data()})},a.add_videos=function(){var b=a.active_tag.id;d.add_videos(b)},a.hide_bottomsheet=function(a){m.hide()},a.show_todo_list=function(b){m.show({templateUrl:"assets/angular/html/todo/room.html",scope:a,preserveScope:!0,targetEvent:b})},a.show_more_books=function(){var b=a.active_tag.books.length-a.limit_count;b>8?a.limit_count=a.limit_count+8:(a.hide_show_more=!0,a.limit_count=a.limit_count+b)},a.search_books=function(b){a.info.loading=!0,a.popular_books=[],l.search_books(b,10).then(function(b){a.info.loading=!1,a.did_you_mean=!0,angular.forEach(b,function(a){angular.isUndefined(a.fuzzy)&&this.push(a)},a.popular_books)})},a.add_book=function(b){var c=b.id||b.book_id;h.add_book(a.active_tag.id,c),window.location.reload()},a.update_room_news_visit=function(){var a=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.room.news||(deleteCookie("todo"),h.update_todo_key("room/news")))};a()},a.goto_news_page=function(a,b){h.news_visited(a),deleteCookie("active_community"),angular.isDefined(b)&&setCookie("active_community",b,1),window.location.href="/news?q="+a},a.get_active_class=function(a){var b=f.path(),c=b.substr(1,a.length+1),d=""==c&&"room/home"==a,e="/room/books"!=b&&"/room/videos"!=b&&"/room/wiki"!=b&&"/room/home"!=b;return e?"room/home"==a?"bold red_color":"grey_color":c==a||d?"bold red_color":"grey_color"},a.show_book_dialog=function(b,d){j.show_book_dialog(c,a,b,d)},a.toggle_follow=function(){var c=""==getCookie("logged")||null==getCookie("logged");c?i("signup").toggle():(a.active_tag.status=!a.active_tag.status,b.follow(a.active_tag.id,a.active_tag.status))},a.refresh_data=function(){b.get_community_details(a.active_tag.id).then(function(b){angular.isDefined(b[0])?(a.active_tag=angular.extend(a.active_tag,b[0].most_important_tag[0]),a.info.loading=!1):a.info.loading=!1})},a.get_community_news=function(){j.get_community_news(a)};(function(){var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());if(null!=c)var d=c[2];else var d=getCookie("id");angular.isDefined(d)?(a.active_tag={id:d},a.get_detailed_community_info()):alert("Bad url"),angular.isUndefined(a.popular_books)&&(a.popular_books=[]),a.is_room=!0,a.limit_count=6,a.info.active_time=2015})()}]);;homeApp.controller("newHomeController",["$scope","$timeout","SearchUIConstants","ReadTimes","genreService","PopularGenres","$mdBottomSheet","userService",function(a,b,c,d,e,f,g,h){a.show_filter_results=function(){var b="";if(angular.isDefined(a.info.selected_duration)&&null!=a.info.selected_duration){var c="d="+a.info.selected_duration.id;b=c}if(angular.isDefined(a.info.selected_genre)&&null!=a.info.selected_genre){var d="g="+a.info.selected_genre.id;b=""!=b?b+"&"+d:d}""!=b?window.location.href="/books?"+b:window.location.href="/books"},a.show_todo_list=function(b){g.show({templateUrl:"assets/angular/html/todo/home.html",scope:a,preserveScope:!0,targetEvent:b})},a.search_genres=function(b){angular.isDefined(b)&&b.length>2?a.info.loading?a.info.genres=[]:(a.info.loading=!0,e.search_star_genres(b).then(function(b){a.info.loading=!1,a.info.genres=b})):a.info.genres=f},a.search_reading_time=function(){a.info.loading=!0,a.search_tag.read_time=""};(function(){a.info.read_times=[],a.info.genres=[],a.info.read_times=d,a.info.genres=f,a.filters={other:{}},a.search_tag={}})()}]);;homeApp.controller("libraryController",["$scope","$rootScope","$timeout","WebsiteUIConstants","SearchUIConstants","bookService","$routeParams","$location","ColorConstants","$mdToast","infinityService","$mdBottomSheet","$mdSidenav","sharedService","$cookieStore","$mdDialog","userService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href),e="";return null!=d&&(e=d[1]),""==e&&(e=null),e}a.get_popular_books=function(){var c=a.info.author_filter||a.info.group_by_alphabet||a.info.reading_time_filter||a.info.published_era_filter||a.info.subject_filter;c||(angular.isUndefined(a.constant)||!a.constant.show_book)&&(Object.keys(b.filters).length>0?a.info.fetching_books||n.filtered_books(a):n.get_popular_books(a,a.info.books))},a.show_todo_list=function(b){l.show({templateUrl:"assets/angular/html/todo/filters.html",scope:a,preserveScope:!0,targetEvent:b})},a.render_page=function(a){n.render_page(a)},a.show_bottom_filters=function(b){l.show({templateUrl:"/assets/angular/html/library/bottom_sheet_filters.html",targetEvent:b,scope:a,preserveScope:!0,controller:"filtersController"})},a.remove_expanded_book=function(b){a.info.books.splice(b,1),delete a.expanded_book,delete a.expanded_index},a.expand_book=function(c){if(b.pages)if(window.innerWidth>1100)var d=3;else if(window.innerWidth>900)var d=3;else var d=2;else if(window.innerWidth>1100)var d=6;else if(window.innerWidth>900)var d=4;else var d=2;var e=function(b){var c={title:a.info.books[b].title,author_name:a.info.books[b].author_name,page_count:a.info.books[b].page_count,published_year:a.info.books[b].published_year,description:a.info.books[b].description,expanded:!0,id:a.info.books[b].id||a.info.books[b].book_id,isbn:a.info.books[b].isbn,root_category:a.info.books[b].root_category,bookmark_count:a.info.books[b].bookmark_count,goodness_index:a.info.books[b].goodness_index,book_reader_relationship_index:a.info.books[b].book_reader_relationship_index,likability_index:a.info.books[b].likeability_index,popularity_index:a.info.books[b].popularity_index};a.expanded_index=b,b=d*Math.floor(b/d)+d,a.expanded_book=b,a.info.books.splice(b,0,c)};angular.isDefined(a.expanded_index)?a.expanded_index==c?(c=d*Math.floor(c/d)+d,a.remove_expanded_book(c)):(a.info.books.splice(a.expanded_book,1),c>a.expanded_book&&(c-=1),e(c)):e(c)},a.init_book=function(b){var c=a.info.books[b];f.get_basic_details(c).then(function(c){a.info.books[b]=angular.extend(a.info.books[b],c)})},a.ungroup=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_author=function(){a.info.author_filter=!0,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_alphabet=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!0,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_reading_time=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!0,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_published_era=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!0,a.info.subject_filter=!1},a.group_by_subject=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!0},a._get_popular_books=function(){n.load_popular_books(a,a.info.books)},a.show_grid=function(b){a.constant.show_book&&(a.grid_style={height:"initial","padding-bottom":"100px"},a.constant={show_book:!1})},a.show_book=function(a,b){var c=b.book_id||b.id;window.location.href="/book?id="+c};a.show_right_nav=function(a){m("alphabets_sidenav").toggle(),a.stopPropagation()},a.show_left_nav=function(a){m("sort_by_sidenav").toggle(),a.stopPropagation()};(function(){a.$routeParams=g,a.filters={other:{}},a.grid={},a.info.books=[],a.search_tag={},a.active_tab={},a.info.categories=[],a.friends=[],a.active_endorse=!1,a.active_bookmark=!0,a.active_share=!0;var b=r("g"),d=r("d");if(null==b&&null==d){var e=c(function(){a._get_popular_books()},100);a.$on("destroy",function(){c.cancel(e)})}a.constant={show_book:!1}})()}]);;homeApp.controller("filtersController",["$scope","$rootScope","$timeout","genreService","authorService","WebsiteUIConstants","SearchUIConstants","$location","sharedService","$mdBottomSheet","PopularAuthors","Times","PopularGenres","ReadTimes",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href),e="";return null!=d&&(e=d[1]),e}a.close_filters=function(){j.hide()},a.reset_filter=function(){delete a.info.selected_genre,delete a.info.selected_author,delete a.info.selected_year,delete a.info.selected_duration,delete a.search_tag.genre,delete a.search_tag.time_group,delete a.search_tag.author,delete a.search_tag.read_time,b.filters={},p()};var p=function(){a.info.infinity=!0,a.info.books=[],q()?i.get_popular_books(a):i.filtered_books(a)},q=function(){var a=Object.keys(b.filters),c=a.indexOf("other")>=0,d=a.indexOf("skip_count")>=0,e=1==a.length&&(c||d),f=2==a.length&&c&&d,g=0==a.length||f||e;return g},r=function(){b.filters.skip_count;delete b.filters.skip_count,delete a.info.other_info,a.info.books=[],q()?i.get_popular_books(a):p()};a.select_genre=function(a){angular.isUndefined(a)||null==a?(delete b.filters.genre_id,r()):(b.filters.genre_id=a.id,p())},a.select_author=function(a){angular.isUndefined(a)||null==a?(delete b.filters.author_id,r()):(b.filters.author_id=a.id,p())},a.select_reading_time=function(a){angular.isUndefined(a)||null==a?(delete b.filters.reading_time_id,r()):(b.filters.reading_time_id=a.id,p())},a.select_publishing_year=function(a){angular.isUndefined(a)||null==a?(delete b.filters.era_id,r()):(b.filters.era_id=a.id,p())},a.search_genres=function(b){angular.isDefined(b)&&b.length>2?a.info.loading?a.info.genres=[]:(a.info.loading=!0,d.search_star_genres(b).then(function(b){a.info.loading=!1,a.info.genres=b})):a.info.genres=m},a.search_reading_time=function(){a.info.loading=!0,a.search_tag.read_time=""},a.search_publishing_year=function(){},a.search_authors=function(b){!a.info.loading&&angular.isDefined(b)&&b.length>2?(a.info.loading=!0,e.search_authors(b).then(function(b){a.info.loading=!1,b.length>0&&(a.info.authors=[],angular.forEach(b,function(a){var b={icon2:"icon-pen",type:g.AuthorSearch,custom_option:!0};b=angular.extend(b,a),this.push(b)},a.info.authors))})):!a.info.loading&&angular.isDefined(b)&&b.length<3&&(a.top_authors?a.info.authors=a.top_authors:a.info.authors=k)},a._detect_key=function(a){var b=a.keyCode==f.Backspace||a.keyCode==f.Delete,c=a.keyCode==f.KeyUp,d=a.keyCode==f.KeyDown,e=a.keyCode==f.KeyLeft,g=a.keyCode==f.KeyRight,h=a.keyCode==f.Enter;return{backspace_or_delete:b,keyUp:c,keyDown:d,keyLeft:e,keyRight:g,keyEnter:h}};(function(){a.search_tag={},a.info.time_groups=l,a.info.read_times=n,a.info.genres=m,a.info.authors=k,angular.isUndefined(b.filters)&&(b.filters={});var c=o("g"),e=o("d");null!=c&&(angular.forEach(a.info.genres,function(b){b.id==c&&(a.info.selected_genre=b)}),angular.isUndefined(a.info.selected_genre)&&""!=c&&(a.info.selected_genre={id:c},d.get_basic_details(c).then(function(b){a.info.selected_genre=b,a.info.genres.push(b)}))),null!=e&&(angular.forEach(a.info.read_times,function(b){b.id==e&&(a.info.selected_duration=b)}),angular.isUndefined(a.info.selected_duration)&&""!=e&&(a.info.selected_duration={id:e}))})()}]);;homeApp.directive("gotoTestimonial",["$rootScope",function(a){return{restrict:"E",controller:["$scope",function(a){}],templateUrl:"/assets/angular/html/shared/partials/goto_testimonial.html"}}]);;homeApp.service("roomService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_books_grouped_by_shelves=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/book_shelves?id="+c,b,a):_deferred_request("/api/v0/book_shelves",b,a)},this.get_articles_grouped_by_shelves=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/article_shelves?id="+c,b,a):_deferred_request("/api/v0/article_shelves",b,a)},this.get_visited_articles=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/visited_articles?id="+c,b,a):_deferred_request("/api/v0/visited_articles",b,a)},this.get_visited_books=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/visited_books?id="+c,b,a):_deferred_request("/api/v0/visited_books",b,a)}}]);;homeApp.controller("roomController",["$scope","$rootScope","$timeout","roomService","ColorConstants",function(a,b,c,d,e){}]);;homeApp.directive("guestInterview",["$rootScope","authorService","$timeout",function(a,b,c){return{restrict:"E",scope:{author:"=",info:"="},controller:["$scope",function(a){var c=function(){a.info.loading=!0,b.get_interview_details(a.author.id).then(function(b){a.info.loading=!1,a.data=b})};c()}],templateUrl:"/assets/angular/html/author/guest_interview.html"}}]);;homeApp.controller("authorController",["$scope","$location","$mdSidenav","authorService","$mdDialog","userService","$filter","$sce","$rootScope","WebsiteUIConstants","$timeout","sharedService","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.toggle_follow=function(){if(angular.isDefined(a.author.status)){var b=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.author.follow||(deleteCookie("todo"),f.update_todo_key("author/follow")))};b(),a.author.status=!a.author.status,d.follow(a.author.id,a.author.status)}else c("signup").toggle()},a.render_page=function(a){l.render_page(a)},a.show_todo_list=function(b){m.show({templateUrl:"assets/angular/html/todo/author.html",scope:a,preserveScope:!0,targetEvent:b})},a.show_more_books=function(){var b=a.author.books.length-a.limit_count;b>8?a.limit_count=a.limit_count+8:(a.hide_show_more=!0,a.limit_count=a.limit_count+b)},a.keypress_scroll=function(b){b.keyCode==j.KeyDown?a.active_index=a.next_block(a.active_index):b.keyCode==j.KeyUp&&(a.active_index=a.previous_block(a.active_index))},a.show_book_dialog=function(b,c){l.show_book_dialog(i,a,b,c)},a.scroll_wiki=function(){},a.toggle_wiki=function(){a.show_author_wiki=!a.show_author_wiki},a.show_authors_nav=function(a){c("authors_detail_sidenav").toggle(),a.stopPropagation()},a.load_books=function(){0==a.data.selectedIndex&&a.get_books()},a.get_books=function(b){if(angular.isUndefined(a.info.loading)||!a.info.loading){var c=function(b){b.indexOf("google")<0?a.author.wiki_url=b:a.author.wiki_url=b.substring(b.lastIndexOf("?q=")+3,b.lastIndexOf("&sa"))};if(angular.isUndefined(b)&&(b=a.author.id),a.info.loading=!0,angular.isDefined(a.author)&&angular.isDefined(a.author.books))var e=a.author.books.length;else var e=0;d.get_details(b,e).then(function(b){0==e?a.author=b:(1==b.books.length&&null==b.books[0].title&&(b.books=[]),a.author.books=a.author.books.concat(b.books)),null!=b.wiki_url&&""!=b.wiki_url&&(c(b.wiki_url),a.author.wiki_url=h.trustAsResourceUrl(a.author.wiki_url+"?action=render")),1==a.author.books.length&&null==a.author.books[0].title?a.author.books=[]:angular.forEach(a.author.books,function(b,c){var d=g("large_thumb")(b);if(""!=d)var e={custom_style:{"background-image":"url('"+d+"')"}};else var e={custom_style:{}};a.author.books[c]=angular.extend(a.author.books[c],e)}),a.info.loading=!1})}},a.get_active_class=function(a){var c=""==b.path().substr(1,a.length+1)&&"books"==a;return b.path().substr(1,a.length+1)==a||c?"bold red_color":"grey_color"};(function(){var c=/[?&]([^=#]+)=([^&#]*)/g,d=c.exec(b.absUrl());if(null!=d)var e=d[2];else var e=getCookie("id");angular.isUndefined(a.info)&&(a.info={}),a.active_index=0;var f=k(function(){a.get_books(e)},100);a.$on("destroy",function(){k.cancel(f)}),a.limit_count=8})()}]);;homeApp.service("roomService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_books_grouped_by_shelves=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/book_shelves?id="+c,b,a):_deferred_request("/api/v0/book_shelves",b,a)},this.get_articles_grouped_by_shelves=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/article_shelves?id="+c,b,a):_deferred_request("/api/v0/article_shelves",b,a)},this.get_visited_articles=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/visited_articles?id="+c,b,a):_deferred_request("/api/v0/visited_articles",b,a)},this.get_visited_books=function(c){return angular.isDefined(c)?_deferred_request("/api/v0/visited_books?id="+c,b,a):_deferred_request("/api/v0/visited_books",b,a)}}]);;homeApp.directive("friendInfo",["$rootScope","userService",function(a,b){return{restrict:"E",scope:{friend:"=",info:"="},controller:["$scope",function(a){var c=function(){angular.isDefined(a.friend)&&b.get_user_details(a.friend.id).then(function(b){a.friend=angular.extend(a.friend,b)})};c()}],templateUrl:"/assets/angular/html/shared/partials/friend_info.html"}}]),homeApp.directive("authorInfo",["$rootScope","authorService","ColorConstants","$mdDialog",function(a,b,c,d){return{restrict:"E",scope:{author:"=",info:"="},controller:["$scope",function(a){var c=function(){angular.isDefined(a.author)&&b.get_basic_info(a.author.id).then(function(b){a.author=angular.extend(a.author,b)})};c()}],templateUrl:"/assets/angular/html/shared/partials/author_info.html"}}]),homeApp.directive("communityInfo",["$rootScope","newsService","ColorConstants","$mdDialog","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{community:"=",info:"="},controller:["$scope",function(c){c.show_book_dialog=function(b,d){e.show_book_dialog(a,c,b,d)};var d=function(){angular.isDefined(c.community)&&b.get_feed_info(c.community.id).then(function(a){c.community=angular.extend(c.community,a)})};d()}],templateUrl:"/assets/angular/html/shared/partials/community_info.html"}}]),homeApp.directive("bookShelf",["$rootScope","roomService","$mdDialog","sharedService",function(a,b,c,d){return{restrict:"E",scope:{shelf:"=",info:"="},controller:["$scope",function(b){b.toggle=function(){b.show_shelf=!b.show_shelf},b.show_indexes=function(a,d){b.book=a,c.show({templateUrl:"assets/angular/html/shared/rating.html",clickOutsideToClose:!0,hasBackdrop:!1,targetEvent:d,scope:b,preserveScope:!0}),d.stopPropagation()},b.add_books_to_shelf=function(c,d){a.active_shelf=c,b.info.show_book_share=!0};var d=function(){1==b.shelf.books.length&&null==b.shelf.books[0].title?b.show_shelf=!1:b.shelf.books.length>0?b.show_shelf=!0:b.show_shelf=!1};d()}],templateUrl:"/assets/angular/html/room/partials/book_shelf.html"}}]),homeApp.directive("articleShelf",["$rootScope","roomService","ColorConstants",function(a,b,c){return{restrict:"E",scope:{shelf:"="},controller:["$scope",function(a){a.toggle=function(){a.show_shelf=!a.show_shelf};var b=function(){1==a.shelf.articles.length&&null==a.shelf.articles[0].title?a.show_shelf=!1:a.shelf.articles.length>0?a.show_shelf=!0:a.show_shelf=!1};b()}],templateUrl:"/assets/angular/html/room/partials/article_shelf.html"}}]),homeApp.directive("articles",["$rootScope","roomService","userService",function(a,b,c){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var d=function(){b.get_visited_articles(a.userId).then(function(b){angular.isUndefined(a.visited_articles)&&(a.visited_articles=[]),a.visited_articles=a.visited_articles.concat(b),a.shelf_loading=!1})},e=function(){a.shelf_loading=!0,d();var b=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.profile.history||(deleteCookie("todo"),c.update_todo_key("profile/history")))};b()};e()}],templateUrl:"/assets/angular/html/room/show.html"}}]),homeApp.directive("articleShelves",["$rootScope","roomService","ColorConstants",function(a,b,c){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var c=function(){b.get_articles_grouped_by_shelves(a.userId).then(function(b){a.articles_grouped_by_shelves=b,a.shelf_loading=!1})},d=function(){a.shelf_loading=!0,c()};d()}],templateUrl:"/assets/angular/html/room/_right_panel.html"}}]),homeApp.directive("bookShelves",["$rootScope","roomService","userService",function(a,b,c){return{restrict:"E",scope:{userId:"="},controller:["$scope",function(a){var d=function(){b.get_books_grouped_by_shelves(a.userId).then(function(b){angular.isUndefined(a.book_shelves)&&(a.book_shelves=[]),a.book_shelves=b,e(),a.shelf_loading=!1})},e=function(){var b=function(a,b){var c=!1,d=0;return angular.forEach(b,function(b,e){a==b.shelf&&(c=!0,d=e)}),{status:c,index:d}},c=[];angular.forEach(a.book_shelves,function(a){var d=b(a.shelf,c);d.status?c[d.index].books.push(a.books[0]):c.push(a)}),a.book_shelves=c},f=function(){a.shelf_loading=!0;var b=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.profile.shelves||(deleteCookie("todo"),c.update_todo_key("profile/shelves")))};b(),d()};f()}],templateUrl:"/assets/angular/html/room/_left_panel.html"}}]);;homeApp.controller("genresController",["$scope","$rootScope","$timeout","userService","genreService","WebsiteUIConstants","$mdToast",function(a,b,c,d,e,f,g){a.save_genre=function(a){var b={genre:a.id,status:!0};d.save_user_info(b)},a.remove_genre=function(a){var b={genre:a.id,status:!1};d.save_user_info(b)},a.edit_genres_like=function(){a.goto_info_card(),b.user.profile_status=1,a._get_genres()},a._get_genres=function(){a.info.loading=!0,(angular.isUndefined(a.info.genres)||0==a.info.genres.length)&&(a.info.genres=[],e.get_categories().then(function(b){angular.forEach(b,function(a){var b=0!=a.likes_weight&&null!=a.likes_weight,c=f.GenreAWS+a.root_category_aws_key,d=angular.extend({status:b,url:c},a);this.push(d)},a.info.genres),a.info.loading=!1}))},a.select_genre=function(b){if(b.status){b.status=!1;var c={category_id:b.root_category_id,status:!1}}else{b.status=!0;var c={category_id:b.root_category_id,status:!0}}g.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/select_genre.html",hideDelay:6e3,position:a.getToastPosition()}),d.save_user_info(c)},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},_init=function(){a.toast_position={bottom:!1,top:!0,left:!1,right:!0};var b=c(function(){a._get_genres()},100);a.$on("destroy",function(){c.cancel(b)})},_init()}]);;homeApp.controller("networkController",["$scope","$rootScope","networkService","$location","$mdToast","userService",function(a,b,c,d,e,f){a.get_followers=function(){a.selectedIndex=0,a.load_followers()},a.toggle_follow=function(a){angular.isDefined(a.status)&&null!=a.status?(a.status=null,f.follow(a.id,!1)):(a.status=!0,f.follow(a.id,!0))},a.load_followers=function(){if(!a.info.loading){a.info.loading=!0;var b=a.users_list.length,d=a.active_user_id;c.get_followers(b,d).then(function(b){b&&0==b.length?a.hide_show_more=!0:a.users_list=a.users_list.concat(b),a.info.loading=!1})}},a.load_users_followed=function(){if(!a.info.loading){a.info.loading=!0;var b=a.users_list.length,d=a.active_user_id;c.get_users_followed(b,d).then(function(b){b&&0==b.length?a.hide_show_more=!0:a.users_list=a.users_list.concat(b),a.info.loading=!1})}},a.get_users_followed=function(){a.selectedIndex=1,a.load_users_followed()},a.load_users=function(){angular.isUndefined(a.users_list)&&(a.users_list=[]);var b="/profile/followers"==d.path(),c="/profile/followings"==d.path();b?a.get_followers():c&&a.get_users_followed()},a.say_thanks=function(){e.show({controller:"toastController",templateUrl:"assets/angular/html/shared/toast/invite_success.html",hideDelay:6e3,position:a.getToastPosition()})},a.getToastPosition=function(){return Object.keys(a.toast_position).filter(function(b){return a.toast_position[b]}).join(" ")},a.facebook_invite=function(){navigator.userAgent.indexOf("Mobi")>-1?FB.ui({method:"send",title:"Hey! Check this awesome book discovery website..",message:"Spread the love for books",link:"http://www.oditty.me/"},a.say_thanks()):window.location.replace("https://www.facebook.com/dialog/send?app_id=667868653261167&link=http://www.oditty.me&redirect_uri=http://oditty.me/network?q=0")};(function(){var c=/[?&]([^=#]+)=([^&#]*)/g,e=c.exec(d.absUrl());a.load_users(),angular.isUndefined(b.user)?f.get_user_details().then(function(c){b.user=c,a.profile_user=b.user,a.active_user_id=a.profile_user.id}):(a.profile_user=b.user,a.active_user_id=a.profile_user.id),angular.isDefined(e)&&null!=e&&(a.active_user_id=e[2]),a.hide_follow=!0,a.toast_position={bottom:!1,top:!0,left:!1,right:!0}})()}]);;homeApp.controller("profileController",["$scope","userService","$rootScope","WebsiteUIConstants","ColorConstants","$location","bookService","newsService","$mdDialog","infinityService","$timeout","sharedService","$mdSidenav","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.show_todo_list=function(b){n.show({templateUrl:"assets/angular/html/todo/profile.html",scope:a,preserveScope:!0,targetEvent:b})},a.hide_bottomsheet=function(a){n.hide()},a.toggle_genres=function(){a.show_genres=!a.show_genres},a.get_active_class=function(a){var b=""==f.path().substr(1,a.length+1)&&"profile/feed"==a;return f.path().substr(1,a.length+1)==a||b?"bold red_color":"grey_color"},a.get_feed=function(){a.info.selectedIndex=1;var c="/profile/followers"==f.path(),d="/profile/followings"==f.path(),e="/profile/books"==f.path(),g="/profile/news"==f.path(),h="/profile/history"==f.path(),i="/profile/rooms"==f.path(),j=!(c||d||e||g||h||i||h);if(!a.info.loading&&j){var k=a.active_user_id;a.info.loading=!0;var l=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10.";break;case"FollowsNode":angular.isDefined(a.community)?b="Joined a room.":angular.isDefined(a.author)?b="Started following an Author.":angular.isDefined(a.friend)&&(b="Started following.");break;case"RecommendNode":b="Recommended this book to a friend."}return b};angular.isUndefined(a.personal_feed)&&(a.personal_feed=[]);var m=a.personal_feed.length;b.get_personal_feed(k,m).then(function(b){b.length>0&&angular.forEach(b,function(a){if(angular.isDefined(a.book)){var b=l(a);a=angular.extend(a,{message:b})}else if(angular.isDefined(a.community)){var b=l(a);a=angular.extend(a,{message:b})}else{var b=l(a);a=angular.extend(a,{message:b})}}),a.info.loading=!1,a.personal_feed=a.personal_feed.concat(b)})}};var o=function(){return""==getCookie("logged")||null==getCookie("logged")};a.follow_user=function(){o()?m("signup").toggle():(a.profile_user.status=!a.profile_user.status,b.follow(a.profile_user.id,a.profile_user.status))};a.show_book_dialog=function(b,d){l.show_book_dialog(c,a,b,d)};var p=function(){var b=!1;return a.active_user_id==c.user.id?(b=!0,a.info.my_profile=!0,a.hide_follow_links=!1):(a.info.my_profile=!1,a.hide_follow_links=!0),b},q=function(){var c=p();c?t():b.get_user_details(a.active_user_id).then(function(b){a.profile_user=b,r()})},r=function(){var b=a.profile_user.image_url||"/assets/user_profile.jpg";a.profile_wrapper={"background-image":b}},s=function(d){a.active_user_id=d[2],angular.isDefined(c.user)?q():b.get_user_details().then(function(a){c.user=a,q()})},t=function(){a.profile_user=c.user,a.active_user_id=a.profile_user.id,r()},u=function(){if(a.info.my_profile=!0,a.hide_follow_links=!1,angular.isUndefined(c.user)){var d=k(function(){b.get_user_details().then(function(a){c.user=a,t()})},100);a.$on("destroy",function(){k.cancel(d)})}else t();w()},v=function(){var b=k(function(){a.get_feed()},100);a.$on("destroy",function(){k.cancel(b)})},w=function(){var b=getCookie("todo");b&&(b=JSON.flatten(JSON.parse(b)));var c=0;angular.forEach(b,function(a,b){a&&(c+=1)}),a.profile_progress=Math.round(100*(c/15))};(function(){a.profile_user={},a.info.embed_share=!0;var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());angular.isDefined(c)&&null!=c?s(c):u(),v(),a.is_profile=!0})()}]);;homeApp.controller("searchPageController",["$scope","searchService","$location","ColorConstants","sharedService","$rootScope",function(a,b,c,d,e,f){a.show_all_results=function(c,e){if(a.search_ready&&(angular.isUndefined(a.info.loading)||!a.info.loading)){var c=c||a.active_q,e=e||a.active_type;a.info.loading=!0,angular.isUndefined(a.all_results)&&(a.all_results=[]);var f={type:e,q:c,skip:a.all_results.length,count:10};b.raw(f).then(function(b){angular.forEach(b,function(a){if(a.labels.indexOf("Book")>=0){var b=Math.floor(Math.random()*d.value.length);a=angular.extend(a,{color:d.value[b]})}this.push(a)},a.all_results),a.info.loading=!1})}},a.show_book_dialog=function(b,c){e.show_book_dialog(f,a,b,c)},a.reload_results=function(a){switch(a){case"Book":break;case"Author":break;case"Community":break;case"Blog":break;case"Person":break;case"News":}};(function(){var b=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))};a.search_results=[];var d=/[?&]([^=#]+)=([^&#]*)/g,e=d.exec(c.absUrl()),f=c.$$absUrl.indexOf("search")>=0;if(angular.isDefined(e)&&null!=e&&f){var g=b("q"),h=b("type");a.search_ready=!0,a.active_q=g,a.active_type=h,a.show_all_results(),a.display_results_for=g}})()}]);;homeApp.controller("spacesController",["$scope","$rootScope","userService","$timeout","$mdSidenav","sharedService",function(a,b,c,d,e,f){a.get_feed=function(){if(!a.info.feed_loading){if(a.info.feed_loading=!0,angular.isDefined(a.social_feed))var b=a.social_feed.length;else{var b=0;a.social_feed=[]}angular.isDefined(a.global)&&a.global?c.get_global_feed(b).then(function(b){a.info.feed_loading=!1,a.social_feed=a.social_feed.concat(b)}):c.get_social_feed(b).then(function(b){a.info.feed_loading=!1,a.social_feed=a.social_feed.concat(b)})}},a.render_page=function(a){f.render_page(a)};var g=function(){return""==getCookie("logged")||null==getCookie("logged")};a.handle_feed=function(){g()?e("signup").toggle():a.get_feed()};(function(){var b=d(function(){a.handle_feed()},100);a.$on("destroy",function(){d.cancel(b)})})()}]);