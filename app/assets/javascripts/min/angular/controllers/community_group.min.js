homeApp.directive("timeTravel",["websiteService","$timeout","$location","CompressedYears","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{info:"=",activeTag:"="},controller:["$scope",function(a){a.show_all_times=function(){a.show_all=!a.show_all},a.get_active_class=function(a){var b=c.path().substr(1,a.length+1).replace("/",""),d=""==b&&"recent"==a;return b.indexOf(a)>=0||d?"active_time":b.indexOf("room")>=0&&"recent"==a?"active_time":void 0};var b=function(){a.active_tag=a.activeTag;var b=c.path().substr(1,5).replace("/",""),f=c.path().substr(1,7),g=c.path().split("/")[2];angular.isDefined(a.active_tag)&&delete a.active_tag.news,f.indexOf("recent")>=0||""==b||"room"==b?(a.show_all=!1,a.info.active_time="recent"):(b.indexOf("2014")>=0||b.indexOf("2013")>=0||b.indexOf("1998")>=0?a.show_all=!1:a.show_all=!0,a.info.active_time=b.replace("/","")),angular.isUndefined(g)?"recent"==a.info.active_time?a.info.active_month="Sept":a.info.active_month="Dec":a.info.active_month=g,e.get_community_news(a),a.years=d};b()}],templateUrl:"/assets/angular/html/shared/time_travel.html"}}]),homeApp.directive("months",["websiteService","$timeout","$location","Months","sharedService",function(a,b,c,d,e){return{restrict:"E",scope:{info:"="},controller:["$scope",function(a){a.get_active_class=function(b){b=a.info.active_time+"/"+b;var d=c.path().substr(1,b.length+1),e=""==d&&"recent"==b;if(d.indexOf(b)>=0||e)return"active_time";if(b.indexOf(d)>=0)if(b.indexOf("recent")>=0){if(b.indexOf("Sept")>=0)return"active_time"}else if(b.indexOf("Dec")>=0)return"active_time"};var b=function(){a.months=d};b()}],templateUrl:"/assets/angular/html/shared/months.html"}}]);;homeApp.controller("videoController",["$scope","$rootScope","$timeout","websiteService","$sce",function(a,b,c,d,e){a.add_video=function(b){var c=a.active_tag.id;d.add_video(c,b)};(function(){if(angular.isDefined(a.active_tag)&&angular.isDefined(a.active_tag.id)){var b=a.active_tag.id;d.get_community_videos(b).then(function(b){a.active_tag.videos=[],angular.forEach(b,function(a){a.url=a.url.replace("watch?v=","v/").replace("https","http").replace("http","https"),a.url=e.trustAsResourceUrl(a.url+"?output=embed"),this.push(a)},a.active_tag.videos)})}else $location.path("/room/books")})()}]);;homeApp.controller("communityController",["$scope","newsService","$rootScope","websiteService","$timeout","$location","$mdDialog","userService","$mdSidenav","sharedService","$sce","bookService","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.get_detailed_community_info=function(){angular.isDefined(a.active_tag)&&b.get_detailed_community_info(a.active_tag.id).then(function(b){a.active_tag=angular.extend(a.active_tag,b);var c=a.active_tag.follows_node;a.active_tag.wiki_url&&null!=a.active_tag.wiki_url&&(a.active_tag.wiki_url=k.trustAsResourceUrl(a.active_tag.wiki_url+"?action=render")),angular.isDefined(c)&&null!=c&&(a.active_tag.status=!0),a.refresh_data()})},a.add_videos=function(){var b=a.active_tag.id;d.add_videos(b)},a.hide_bottomsheet=function(a){m.hide()},a.show_todo_list=function(b){m.show({templateUrl:"assets/angular/html/todo/room.html",scope:a,preserveScope:!0,targetEvent:b})},a.show_more_books=function(){var b=a.active_tag.books.length-a.limit_count;b>8?a.limit_count=a.limit_count+8:(a.hide_show_more=!0,a.limit_count=a.limit_count+b)},a.search_books=function(b){a.info.loading=!0,a.popular_books=[],l.search_books(b,10).then(function(b){a.info.loading=!1,a.did_you_mean=!0,angular.forEach(b,function(a){angular.isUndefined(a.fuzzy)&&this.push(a)},a.popular_books)})},a.add_book=function(b){var c=b.id||b.book_id;h.add_book(a.active_tag.id,c),window.location.reload()},a.update_room_news_visit=function(){var a=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.room.news||(deleteCookie("todo"),h.update_todo_key("room/news")))};a()},a.goto_news_page=function(a,b){h.news_visited(a),deleteCookie("active_community"),angular.isDefined(b)&&setCookie("active_community",b,1),window.location.href="/news?q="+a},a.get_active_class=function(a){var b=f.path(),c=b.substr(1,a.length+1),d=""==c&&"room/home"==a,e="/room/books"!=b&&"/room/videos"!=b&&"/room/wiki"!=b&&"/room/home"!=b;return e?"room/home"==a?"bold red_color":"grey_color":c==a||d?"bold red_color":"grey_color"},a.show_book_dialog=function(b,d){j.show_book_dialog(c,a,b,d)},a.toggle_follow=function(){var c=""==getCookie("logged")||null==getCookie("logged");c?i("signup").toggle():(a.active_tag.status=!a.active_tag.status,b.follow(a.active_tag.id,a.active_tag.status))},a.refresh_data=function(){b.get_community_details(a.active_tag.id).then(function(b){angular.isDefined(b[0])?(a.active_tag=angular.extend(a.active_tag,b[0].most_important_tag[0]),a.info.loading=!1):a.info.loading=!1})},a.get_community_news=function(){j.get_community_news(a)};(function(){var b=/[?&]([^=#]+)=([^&#]*)/g,d=b.exec(f.absUrl());if(null!=d)var e=d[2];else if(c.pages)var e=getCookie("id");angular.isDefined(e)?(a.active_tag={id:e},a.get_detailed_community_info()):alert("Bad url"),angular.isUndefined(a.popular_books)&&(a.popular_books=[]),a.is_room=!0,a.limit_count=6,a.info.active_time=2015})()}]);