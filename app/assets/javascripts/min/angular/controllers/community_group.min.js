homeApp.service("newsService",["$http","$q","$rootScope","WebsiteUIConstants",function(a,b,c,d){this.get_news_info=function(c,d){return angular.isDefined(d)&&""!=d?_deferred_request("/api/v0/news_info?id="+c+"&tag_id="+d,b,a):_deferred_request("/api/v0/news_info?id="+c,b,a)},this.get_chronological_news=function(c){return _deferred_request("/api/v0/chronological_news?id="+c,b,a)},this.get_community_details=function(c){return _deferred_request("/api/v0/basic_community_info?id="+c,b,a)},this.get_metadata=function(c){return _deferred_request("/api/v0/metadata?url="+c,b,a)},this.get_detailed_community_info=function(c){return _deferred_request("/api/v0/detailed_community_info?id="+c,b,a)},this.follow=function(c,d){return _deferred_request("/api/v0/follow_community?id="+c+"&status="+d,b,a)},this.get_feed_info=function(c){return _deferred_request("/api/v0/feed_community_info?id="+c,b,a)},this.news_visited=function(c){return _deferred_request("/api/v0/news_visited?id="+c,b,a)},this.get_community_news=function(c,d){return _deferred_request("/api/v0/get_community_news?id="+c+"&skip="+d,b,a)}}]);;homeApp.controller("videoController",["$scope","$rootScope","$timeout","websiteService","$sce",function(a,b,c,d,e){(function(){if(angular.isDefined(a.active_tag)&&angular.isDefined(a.active_tag.id)){var b=a.active_tag.id;d.get_community_videos(b).then(function(b){a.videos=[],angular.forEach(b,function(a){a.url=a.url.replace("watch?v=","v/"),a.url=e.trustAsResourceUrl(a.url+"?output=embed"),this.push(a)},a.videos)})}else $location.path("/room/books")})()}]);;homeApp.controller("communityController",["$scope","newsService","$rootScope","ColorConstants","$timeout","$location","$mdDialog","userService","$mdSidenav","sharedService","$sce","bookService","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.get_detailed_community_info=function(){angular.isDefined(a.active_tag)&&b.get_detailed_community_info(a.active_tag.id).then(function(b){a.active_tag=angular.extend(a.active_tag,b);var c=a.active_tag.follows_node;a.active_tag.wiki_url&&null!=a.active_tag.wiki_url&&(a.active_tag.wiki_url=k.trustAsResourceUrl(a.active_tag.wiki_url+"?action=render")),angular.isDefined(c)&&null!=c&&(a.active_tag.status=!0)})},a.hide_bottomsheet=function(a){m.hide()},a.show_todo_list=function(b){m.show({templateUrl:"assets/angular/html/todo/room.html",scope:a,preserveScope:!0,targetEvent:b})},a.show_more_books=function(){var b=a.active_tag.books.length-a.limit_count;b>8?a.limit_count=a.limit_count+8:(a.hide_show_more=!0,a.limit_count=a.limit_count+b)},a.search_books=function(b){a.info.loading=!0,a.popular_books=[],l.search_books(b,10).then(function(b){a.info.loading=!1,a.did_you_mean=!0,angular.forEach(b,function(a){angular.isUndefined(a.fuzzy)&&this.push(a)},a.popular_books)})},a.add_book=function(b){var c=b.id||b.book_id;h.add_book(a.active_tag.id,c),window.location.reload()},a.update_room_news_visit=function(){var a=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.room.news||(deleteCookie("todo"),h.update_todo_key("room/news")))};a()},a.goto_news_page=function(a,b){h.news_visited(a),deleteCookie("active_community"),angular.isDefined(b)&&setCookie("active_community",b,1),window.location.href="/news?q="+a},a.get_active_class=function(a){var b=""==f.path().substr(1,a.length+1)&&"room/books"==a;return f.path().substr(1,a.length+1)==a||b?"bold red_color":"grey_color"},a.show_book_dialog=function(b,d){j.show_book_dialog(c,a,b,d)},a.toggle_follow=function(){var c=""==getCookie("logged")||null==getCookie("logged");c?i("signup").toggle():(a.active_tag.status=!a.active_tag.status,b.follow(a.active_tag.id,a.active_tag.status))},a.refresh_data=function(){b.get_community_details(a.active_tag.id).then(function(b){angular.isDefined(b[0])?(a.active_tag=angular.extend(a.active_tag,b[0].most_important_tag[0]),a.info.loading=!1):a.info.loading=!1})},a.get_community_news=function(){var c="/room/news"==f.path();if(angular.isDefined(a.active_tag)&&c){var d=a.active_tag.id,e=a.active_tag.news.length;a.info.loading||(a.info.loading=!0,b.get_community_news(d,e).then(function(b){null!=b&&b.length>0&&(b=b[0],a.active_tag.news=a.active_tag.news.concat(b.news)),a.info.loading=!1}))}};(function(){var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());if(null!=c){a.info.loading=!0;var d=c[2];a.active_tag={id:d},a.get_detailed_community_info(),e(function(){a.refresh_data()},2e3)}else alert("Bad url");angular.isUndefined(a.popular_books)&&(a.popular_books=[]),a.is_room=!0;var g=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.rooms.visit||(deleteCookie("todo"),h.update_todo_key("rooms/visit")))};g(),a.limit_count=6})()}]);