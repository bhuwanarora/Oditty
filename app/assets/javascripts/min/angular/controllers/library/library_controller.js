homeApp.controller("libraryController",["$scope","$rootScope","$timeout","WebsiteUIConstants","SearchUIConstants","bookService","$routeParams","$location","ColorConstants","$mdToast","infinityService","$mdBottomSheet","$mdSidenav","sharedService","$cookieStore","$mdDialog","userService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href),e="";return null!=d&&(e=d[1]),""==e&&(e=null),e}a.get_popular_books=function(){var c=a.info.author_filter||a.info.group_by_alphabet||a.info.reading_time_filter||a.info.published_era_filter||a.info.subject_filter;c||(angular.isUndefined(a.constant)||!a.constant.show_book)&&(Object.keys(b.filters).length>0?a.info.fetching_books||n.filtered_books(a):n.get_popular_books(a,a.info.books))},a.show_todo_list=function(b){l.show({templateUrl:"assets/angular/html/todo/filters.html",scope:a,preserveScope:!0,targetEvent:b})},a.show_bottom_filters=function(b){l.show({templateUrl:"/assets/angular/html/library/bottom_sheet_filters.html",targetEvent:b,scope:a,preserveScope:!0,controller:"filtersController"})},a.remove_expanded_book=function(b){a.info.books.splice(b,1),delete a.expanded_book,delete a.expanded_index},a.expand_book=function(b){if(window.innerWidth>1100)var c=6;else if(window.innerWidth>900)var c=4;else var c=3;var d=function(b){var d={title:a.info.books[b].title,author_name:a.info.books[b].author_name,page_count:a.info.books[b].page_count,published_year:a.info.books[b].published_year,description:a.info.books[b].description,expanded:!0,id:a.info.books[b].id||a.info.books[b].book_id,isbn:a.info.books[b].isbn,root_category:a.info.books[b].root_category,bookmark_count:a.info.books[b].bookmark_count,goodness_index:a.info.books[b].goodness_index,book_reader_relationship_index:a.info.books[b].book_reader_relationship_index,likability_index:a.info.books[b].likeability_index,popularity_index:a.info.books[b].popularity_index};a.expanded_index=b,b=c*Math.floor(b/c)+c,a.expanded_book=b,a.info.books.splice(b,0,d)};angular.isDefined(a.expanded_index)?a.expanded_index==b?(b=c*Math.floor(b/c)+c,a.remove_expanded_book(b)):(a.info.books.splice(a.expanded_book,1),b>a.expanded_book&&(b-=1),d(b)):d(b)},a.init_book=function(b){var c=a.info.books[b];f.get_basic_details(c).then(function(c){a.info.books[b]=angular.extend(a.info.books[b],c)})},a.ungroup=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_author=function(){a.info.author_filter=!0,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_alphabet=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!0,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_reading_time=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!0,a.info.published_era_filter=!1,a.info.subject_filter=!1},a.group_by_published_era=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!0,a.info.subject_filter=!1},a.group_by_subject=function(){a.info.author_filter=!1,a.info.group_by_alphabet=!1,a.info.reading_time_filter=!1,a.info.published_era_filter=!1,a.info.subject_filter=!0},a._get_popular_books=function(){n.load_popular_books(a,a.info.books)},a.show_grid=function(b){a.constant.show_book&&(a.grid_style={height:"initial","padding-bottom":"100px"},a.constant={show_book:!1})},a.show_book=function(a,b){var c=b.book_id||b.id;window.location.href="/book?id="+c};a.show_right_nav=function(a){m("alphabets_sidenav").toggle(),a.stopPropagation()},a.show_left_nav=function(a){m("sort_by_sidenav").toggle(),a.stopPropagation()};(function(){a.$routeParams=g,a.filters={other:{}},a.grid={},a.info.books=[],a.search_tag={},a.active_tab={},a.info.categories=[],a.friends=[],a.active_endorse=!1,a.active_bookmark=!0,a.active_share=!0;var b=r("g"),d=r("d");if(null==b&&null==d){var e=c(function(){a._get_popular_books()},100);a.$on("destroy",function(){c.cancel(e)})}a.constant={show_book:!1}})()}]);