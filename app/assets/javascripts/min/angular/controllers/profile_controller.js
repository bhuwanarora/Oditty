homeApp.controller("profileController",["$scope","userService","$rootScope","WebsiteUIConstants","ColorConstants","$location","bookService","newsService","$mdDialog","infinityService","$timeout","sharedService","$mdSidenav","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.show_todo_list=function(b){n.show({templateUrl:"assets/angular/html/todo/profile.html",scope:a,preserveScope:!0,targetEvent:b})},a.hide_bottomsheet=function(a){n.hide()},a.toggle_genres=function(){a.show_genres=!a.show_genres},a.get_active_class=function(a){var b=""==f.path().substr(1,a.length+1)&&"profile/feed"==a;return f.path().substr(1,a.length+1)==a||b?"bold red_color":"grey_color"},a.get_feed=function(){a.info.selectedIndex=1;var c="/profile/followers"==f.path(),d="/profile/followings"==f.path(),e="/profile/books"==f.path(),g="/profile/news"==f.path(),h="/profile/history"==f.path(),i="/profile/rooms"==f.path(),j=!(c||d||e||g||h||i||h);if(!a.info.loading&&j){var k=a.active_user_id;a.info.loading=!0;var l=function(a){var b="";switch(a.label){case"BookmarkNode":b="Added to "+a.node.key;break;case"Listopia":break;case"CommunityNode":break;case"BlogNode":break;case"StatusNode":b=a.node.wrapper_content;break;case"EndorseNode":b="Endorsed this book.";break;case"RatingNode":b="Gave "+a.node.content+" rating on 10.";break;case"FollowsNode":angular.isDefined(a.community)?b="Joined a room.":angular.isDefined(a.author)?b="Started following an Author.":angular.isDefined(a.friend)&&(b="Started following.");break;case"RecommendNode":b="Recommended this book to a friend."}return b};angular.isUndefined(a.personal_feed)&&(a.personal_feed=[]);var m=a.personal_feed.length;b.get_personal_feed(k,m).then(function(b){b.length>0&&angular.forEach(b,function(a){if(angular.isDefined(a.book)){var b=l(a);a=angular.extend(a,{message:b})}else if(angular.isDefined(a.community)){var b=l(a);a=angular.extend(a,{message:b})}else{var b=l(a);a=angular.extend(a,{message:b})}}),a.info.loading=!1,a.personal_feed=a.personal_feed.concat(b)})}};var o=function(){return""==getCookie("logged")||null==getCookie("logged")};a.follow_user=function(){o()?m("signup").toggle():(a.profile_user.status=!a.profile_user.status,b.follow(a.profile_user.id,a.profile_user.status))};a.show_book_dialog=function(b,d){l.show_book_dialog(c,a,b,d)};var p=function(){var b=!1;return a.active_user_id==c.user.id?(b=!0,a.info.my_profile=!0,a.hide_follow_links=!1):(a.info.my_profile=!1,a.hide_follow_links=!0),b},q=function(){var c=p();c?s():b.get_user_details(a.active_user_id).then(function(b){a.profile_user=b})},r=function(d){a.active_user_id=d[2],angular.isDefined(c.user)?q():b.get_user_details().then(function(a){c.user=a,q()})},s=function(){a.profile_user=c.user,a.active_user_id=a.profile_user.id},t=function(){if(a.info.my_profile=!0,a.hide_follow_links=!1,angular.isUndefined(c.user)){var d=k(function(){b.get_user_details().then(function(a){c.user=a,s()})},100);a.$on("destroy",function(){k.cancel(d)})}else s();v()},u=function(){var b=k(function(){a.get_feed()},100);a.$on("destroy",function(){k.cancel(b)})},v=function(){var b=getCookie("todo");b&&(b=JSON.flatten(JSON.parse(b)));var c=0;angular.forEach(b,function(a,b){a&&(c+=1)}),a.profile_progress=Math.round(100*(c/15))};(function(){a.profile_user={},a.info.embed_share=!0;var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());angular.isDefined(c)&&null!=c?r(c):t(),u(),a.is_profile=!0})()}]);