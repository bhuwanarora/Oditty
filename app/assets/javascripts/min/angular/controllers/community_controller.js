homeApp.controller("communityController",["$scope","newsService","$rootScope","websiteService","$timeout","$location","$mdDialog","userService","$mdSidenav","sharedService","$sce","bookService","$mdBottomSheet",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.get_detailed_community_info=function(){angular.isDefined(a.active_tag)&&b.get_detailed_community_info(a.active_tag.id).then(function(b){a.active_tag=angular.extend(a.active_tag,b);var c=a.active_tag.follows_node;a.active_tag.wiki_url&&null!=a.active_tag.wiki_url&&(a.active_tag.wiki_url=k.trustAsResourceUrl(a.active_tag.wiki_url+"?action=render")),angular.isDefined(c)&&null!=c&&(a.active_tag.status=!0),a.refresh_data()})},a.add_videos=function(){var b=a.active_tag.id;d.add_videos(b)},a.hide_bottomsheet=function(a){m.hide()},a.show_todo_list=function(b){m.show({templateUrl:"assets/angular/html/todo/room.html",scope:a,preserveScope:!0,targetEvent:b})},a.show_more_books=function(){var b=a.active_tag.books.length-a.limit_count;b>8?a.limit_count=a.limit_count+8:(a.hide_show_more=!0,a.limit_count=a.limit_count+b)},a.search_books=function(b){a.info.loading=!0,a.popular_books=[],l.search_books(b,10).then(function(b){a.info.loading=!1,a.did_you_mean=!0,angular.forEach(b,function(a){angular.isUndefined(a.fuzzy)&&this.push(a)},a.popular_books)})},a.add_book=function(b){var c=b.id||b.book_id;h.add_book(a.active_tag.id,c),window.location.reload()},a.update_room_news_visit=function(){var a=function(){var a=getCookie("todo");a&&(a=JSON.parse(a),a.room.news||(deleteCookie("todo"),h.update_todo_key("room/news")))};a()},a.goto_news_page=function(a,b){h.news_visited(a),deleteCookie("active_community"),angular.isDefined(b)&&setCookie("active_community",b,1),window.location.href="/news?q="+a},a.get_active_class=function(a){var b=f.path(),c=b.substr(1,a.length+1),d=""==c&&"room/home"==a,e="/room/books"!=b&&"/room/videos"!=b&&"/room/wiki"!=b&&"/room/home"!=b;return e?"room/home"==a?"bold red_color":"grey_color":c==a||d?"bold red_color":"grey_color"},a.show_book_dialog=function(b,d){j.show_book_dialog(c,a,b,d)},a.toggle_follow=function(){var c=""==getCookie("logged")||null==getCookie("logged");c?i("signup").toggle():(a.active_tag.status=!a.active_tag.status,b.follow(a.active_tag.id,a.active_tag.status))},a.refresh_data=function(){b.get_community_details(a.active_tag.id).then(function(b){angular.isDefined(b[0])?(a.active_tag=angular.extend(a.active_tag,b[0].most_important_tag[0]),a.info.loading=!1):a.info.loading=!1})},a.get_community_news=function(){j.get_community_news(a)};(function(){var b=/[?&]([^=#]+)=([^&#]*)/g,c=b.exec(f.absUrl());if(null!=c){var d=c[2];a.active_tag={id:d},a.get_detailed_community_info()}else alert("Bad url");angular.isUndefined(a.popular_books)&&(a.popular_books=[]),a.is_room=!0,a.limit_count=6})()}]);